@page "{appointmentId:guid}"

@model KoiVeterinaryServiceCenter_FE.Pages.User.Veterinarian.AppointmentDetailModel
@{
    Layout = "_LayoutBoard";
}

<!-- Back Button -->
<div class="mb-3 text-start">
    <a href="https://localhost:7241/User/Customer/Appointments" class="btn btn-outline-primary">
        <i class="fas fa-arrow-left"></i> Back
    </a>
</div>

<!-- Appointment Information Start -->
<div class="container-fluid pt-4 px-4">
    <div class="row g-4">
        <!-- Koi Information Start -->
        @if (Model.GetAppointmentDetailResponse?.Extensions?.Data?.AppointmentDetailKoi != null)
        {
            <div class="col-sm-12 col-xl-6 text-center">
                <img class="rounded-circle" src="~/img/fish.jpg" alt="Koi Image" style="width: 200px; height: 200px;">
                <div class="bg-light rounded p-4 mt-3">
                    <h2 class="mb-4 p-2 bg-primary text-white">Koi Information</h2>
                    <div class="row g-4">
                        <!-- Koi Details -->
                        <div class="col-sm-12 col-xl-6">
                            <div class="bg-light text-center rounded p-4">
                                <p><strong>Name:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Name</span></p>
                                <p><strong>Age:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Age</span></p>
                                <p><strong>Color:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Color</span></p>
                            </div>
                        </div>
                        <div class="col-sm-12 col-xl-6">
                            <div class="bg-light text-center rounded p-4">
                                <p><strong>Quantity:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Quantity</span></p>
                                <p><strong>Weight:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Weight</span></p>
                                <p><strong>Length:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailKoi.Length</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        else
        {
            <div class="col-sm-12 col-xl-6">
                <div class="alert alert-warning text-center">No Koi information available.</div>
            </div>
        }
        <!-- Koi Information End -->
        <!-- Service Information Start -->
        @if (Model.GetAppointmentDetailResponse?.Extensions?.Data?.AppointmentDetailService != null)
        {
            <div class="col-sm-12 col-xl-6">
                <div class="bg-light rounded p-4">
                    <h4 class="text-center text-primary">Appointment Information</h4>
                    <p><strong>Service Name:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.ServiceName</span></p>
                    <p><strong>Service Category:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.ServiceCategory</span></p>
                    <p><strong>Description:</strong> <span class="text-muted">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.PetDescription</span></p>
                    <p><strong>Customer:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailCustomer.FullName</span></p>
                    <p><strong>Email:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailCustomer.Email</span></p>
                    <p><strong>Phone:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailCustomer.PhoneNumber</span></p>
                    <p><strong>Cost:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.Cost</span></p>
                    <p><strong>Duration:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.Duration</span></p>
                    <p><strong>Location:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailCustomer.Address</span></p>
                    <p><strong>Create Date:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.CreateDate.ToString("yyyy-MM-dd")</span></p>
                    <p><strong>Appointment Date:</strong> <span class="text-primary">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailService.AppointmentDate.ToString("yyyy-MM-dd")</span></p>
                </div>
            </div>
        }
        else
        {
            <div class="col-sm-12 col-xl-6">
                <div class="alert alert-warning text-center">No Appointment information available.</div>
            </div>
        }
        <!-- Service Information End -->
    </div>

    <!-- Service Report Start -->
    <div class="row g-4 mt-4">
        <div class="col-sm-12 col-xl-6">
            <div class="bg-light rounded h-100 p-4">
                <h6 class="mb-4">Service Report</h6>
                @if (Model.GetAppointmentDetailResponse?.Extensions?.Data?.AppointmentDetailReport != null)
                {
                    <p><strong>Report Content:</strong> <span class="text-muted">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailReport.ReportContent ?? "No report content available."</span></p>
                    <p><strong>Report Date:</strong> <span class="text-muted">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailReport.ReportDate != default(DateTime) ? Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailReport.ReportDate.ToString("yyyy-MM-dd") : "No report date available."</span></p>
                    <p><strong>Recommendations:</strong> <span class="text-muted">@Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailReport.Recommendations ?? "No recommendations available."</span></p>
                }
                else
                {
                    <p>No service report available.</p>
                }
            </div>
        </div>

        <!-- Prescription Section Start -->
        <div class="col-sm-12 col-xl-6">
            <div class="bg-light rounded h-100 p-4">
                <h6 class="mb-4">Prescription Details</h6>
                <table class="table table-bordered text-center" id="prescriptionDetailsTable">
                    <thead class="table-light">
                        <tr>
                            <th>Medicine Name</th>
                            <th>Quantity</th>
                            <th>Price</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model.GetAppointmentDetailResponse?.Extensions?.Data?.AppointmentDetailReport?.PrescriptionDetail != null)
                        {
                            @foreach (var prescription in Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailReport.PrescriptionDetail)
                            {
                                <tr>
                                    <td>@prescription.MedicineName</td>
                                    <td>@prescription.Quantity</td>
                                    <td>@prescription.Price</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center">No prescription data available.</td>
                            </tr>
                        }
                    </tbody>
                </table>
                <button class="btn btn-primary mb-3" onclick="togglePrescriptionForm()">Add Prescription</button>

                <!-- Add Prescription Form (Initially Hidden) -->
                <div id="prescriptionForm" style="display: none;">
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="medicineName" placeholder="Enter Medicine Name">
                        <label for="medicineName">Medicine Name</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="quantity" placeholder="Enter Quantity">
                        <label for="quantity">Quantity</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="number" class="form-control" id="price" placeholder="Enter Price">
                        <label for="price">Price</label>
                    </div>
                    <button class="btn btn-success" onclick="savePrescription()">Save Prescription</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Vet Information Start -->
    <div class="row g-4 mt-4">
        <div class="col-sm-12 col-xl-6">
            <div class="bg-light rounded p-4">
                <h6 class="mb-3">Vet Information</h6>
                @if (Model.GetAppointmentDetailResponse?.Extensions?.Data?.AppointmentDetailVeterinarian != null)
                {
                    <p><strong>Name:</strong> @Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailVeterinarian.FullName</p>
                    <p><strong>Email:</strong> @Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailVeterinarian.Email</p>
                    <p><strong>Phone:</strong> @Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailVeterinarian.PhoneNumber</p>
                    <p><strong>Address:</strong> @Model.GetAppointmentDetailResponse.Extensions.Data.AppointmentDetailVeterinarian.Address</p>
                }
                else
                {
                    <p class="text-center">No vet information assigned.</p>
                }
            </div>
        </div>
    </div>
</div>
<!-- Appointment Information End -->
<!-- JavaScript for Prescription Form Handling -->
<script>
    function togglePrescriptionForm() {
        const form = document.getElementById('prescriptionForm');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function savePrescription() {
        const medicineName = document.getElementById('medicineName').value;
        const quantity = document.getElementById('quantity').value;
        const price = document.getElementById('price').value;

        if (!medicineName || !quantity || !price) {
            alert("Please fill in all fields.");
            return;
        }

        const table = document.getElementById('prescriptionDetailsTable').querySelector('tbody');
        const row = document.createElement('tr');
        row.innerHTML = `<td>${medicineName}</td><td>${quantity}</td><td>${price}</td>`;
        table.appendChild(row);

        document.getElementById('medicineName').value = '';
        document.getElementById('quantity').value = '';
        document.getElementById('price').value = '';
        togglePrescriptionForm();
    }
</script>
